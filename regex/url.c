#include "url.h"
#include "flags.h"
#include "compileRegur.h"
/*
C# 再线生成	http://www.mcqyy.com/RunCode/csharp/
URL 大全：	http://www.pin5i.com/showtopic-25932.html
*/
/*
 * 网址
 * 只允许http、https、ftp这三种
 * 如：http://www.baidu.com
 */


 /*
 		http://((((([a-zA-Z0-9]([-a-zA-Z0-9]*[a-zA-Z0-9]){0,1})\.)*([a-zA-Z](([-a-zA-Z0-9])*([a-zA-Z0-9])){0,1}))|(([0-9]+)\.){3}([0-9]+))(:([0-9]+)){0,1})(/(((([a-zA-Z0-9]|(\$|-|_|\.|\+)|(!|\*|'|\(|\)|,))|(%([0-9A-Fa-f])([0-9A-Fa-f])))|;|:|@|&|=)*)(/(((([a-zA-Z0-9]|(\$|-|_|\.|\+)|(!|\*|'|\(|\)|,))|(%([0-9A-Fa-f])([0-9A-Fa-f])))|;|:|@|&|=)*))*(\?(((([a-zA-Z0-9]|(\$|-|_|\.|\+)|(!|\*|'|\(|\)|,))|(%([0-9A-Fa-f])([0-9A-Fa-f])))|;|:|@|&|=)*)){0,1}){0,1}

		http://((((((([a-z]|[A-Z])|[0-9])|(([a-z]|[A-Z])|[0-9])((([a-z]|[A-Z])|[0-9])|-)*(([a-z]|[A-Z])|[0-9]))\.)*(([a-z]|[A-Z])|([a-z]|[A-Z])((([a-z]|[A-Z])|[0-9])|-)*(([a-z]|[A-Z])|[0-9])))|([0-9]+)\.([0-9]+)\.([0-9]+)\.([0-9]+))(:([0-9]+)){0,1})(/((((([a-z]|[A-Z])|[0-9]|(\$|-|_|\.|\+)|(!|\*|'|\(|\)|,))|(%([0-9]|A|B|C|D|E|F|a|b|c|d|e|f)([0-9]|A|B|C|D|E|F|a|b|c|d|e|f)))|;|:|@|&|=)*)(/((((([a-z]|[A-Z])|[0-9]|(\$|-|_|\.|\+)|(!|\*|'|\(|\)|,))|(%([0-9]|A|B|C|D|E|F|a|b|c|d|e|f)([0-9]|A|B|C|D|E|F|a|b|c|d|e|f)))|;|:|@|&|=)*))*(\?((((([a-z]|[A-Z])|[0-9]|(\$|-|_|\.|\+)|(!|\*|'|\(|\)|,))|(%([0-9]|A|B|C|D|E|F|a|b|c|d|e|f)([0-9]|A|B|C|D|E|F|a|b|c|d|e|f)))|;|:|@|&|=)*)){0,1}){0,1}

#region Http

            string lowalpha = @"[a-z]";
            string hialpha = @"[A-Z]";
            string alpha = String.Format(@"({0}|{1})", lowalpha, hialpha);
            string digit = @"[0-9]";
            string safe = @"(\$|-|_|\.|\+)";
            string extra = @"(!|\*|'|\(|\)|,)";
            string hex = String.Format(@"({0}|A|B|C|D|E|F|a|b|c|d|e|f)", digit);
            string escape = String.Format(@"(%{0}{0})", hex);
            string unreserved = String.Format(@"({0}|{1}|{2}|{3})", alpha, digit, safe, extra);
            string uchar = String.Format(@"({0}|{1})", unreserved, escape);
            string reserved = @"(;|/|\?|:|@|&|=)";
            string xchar = String.Format(@"({0}|{1}|{2})", unreserved, reserved, escape);
            string digits = String.Format(@"({0}+)", digit);

            string alphadigit = String.Format(@"({0}|{1})", alpha, digit);
            string domainlabel = String.Format(@"({0}|{0}({0}|-)*{0})", alphadigit);
            string toplabel = String.Format(@"({0}|{0}({1}|-)*{1})", alpha, alphadigit);
            string hostname = String.Format(@"(({0}\.)*{1})", domainlabel, toplabel);
            string hostnumber = String.Format(@"{0}\.{0}\.{0}\.{0}", digits);
            string host = String.Format(@"({0}|{1})", hostname, hostnumber);
            string port = digits;
            string hostport = String.Format(@"({0}(:{1}){{0,1}})", host, port);
            string hsegment = String.Format(@"(({0}|;|:|@|&|=)*)", uchar);
            string search = String.Format(@"(({0}|;|:|@|&|=)*)", uchar);
            string hpath = String.Format(@"{0}(/{0})*", hsegment);
            string httpurl = String.Format(@"http://{0}(/{1}(\?{2}){{0,1}}){{0,1}}", hostport, hpath, search);

            #endregion



 #region Ftp

			ftpurl:
			ftp://((((((([a-z]|[A-Z])|[0-9]|(\$|-|_|\.|\+)|(!|\*|'|\(|\)|,))|(%([0-9]|A|B|C|D|E|F|a|b|c|d|e|f)([0-9]|A|B|C|D|E|F|a|b|c|d|e|f)))|;|\?|&|=)*)(:((((([a-z]|[A-Z])|[0-9]|(\$|-|_|\.|\+)|(!|\*|'|\(|\)|,))|(%([0-9]|A|B|C|D|E|F|a|b|c|d|e|f)([0-9]|A|B|C|D|E|F|a|b|c|d|e|f)))|;|\?|&|=)*)){0,1}@){0,1}((((((([a-z]|[A-Z])|[0-9])|(([a-z]|[A-Z])|[0-9])((([a-z]|[A-Z])|[0-9])|-)*(([a-z]|[A-Z])|[0-9]))\.)*(([a-z]|[A-Z])|([a-z]|[A-Z])((([a-z]|[A-Z])|[0-9])|-)*(([a-z]|[A-Z])|[0-9])))|([0-9]+)\.([0-9]+)\.([0-9]+)\.([0-9]+))(:([0-9]+)){0,1}))(/(((((([a-z]|[A-Z])|[0-9]|(\$|-|_|\.|\+)|(!|\*|'|\(|\)|,))|(%([0-9]|A|B|C|D|E|F|a|b|c|d|e|f)([0-9]|A|B|C|D|E|F|a|b|c|d|e|f)))|\?|:|@|&|=)*)(/((((([a-z]|[A-Z])|[0-9]|(\$|-|_|\.|\+)|(!|\*|'|\(|\)|,))|(%([0-9]|A|B|C|D|E|F|a|b|c|d|e|f)([0-9]|A|B|C|D|E|F|a|b|c|d|e|f)))|\?|:|@|&|=)*))*)(;type=(A|I|D|a|i|d)){0,1}){0,1}

            string user = String.Format(@"(({0}|;|\?|&|=)*)", uchar);
            string password = String.Format(@"(({0}|;|\?|&|=)*)", uchar);
            string login = String.Format(@"(({0}(:{1}){{0,1}}@){{0,1}}{2})", user, password, hostport);
            string fsegment = String.Format(@"(({0}|\?|:|@|&|=)*)", uchar);
            string ftptype = @"(A|I|D|a|i|d)";
            string fpath = String.Format(@"({0}(/{0})*)", fsegment);
            string ftpurl = String.Format(@"ftp://{0}(/{1}(;type={2}){{0,1}}){{0,1}}", login, fpath, ftptype);

            #endregion


#region News
			newsurl:
			(news:(\*|(([a-z]|[A-Z])(([a-z]|[A-Z])|[0-9]|-|\.|\+|_)*)|((((([a-z]|[A-Z])|[0-9]|(\$|-|_|\.|\+)|(!|\*|'|\(|\)|,))|(%([0-9]|A|B|C|D|E|F|a|b|c|d|e|f)([0-9]|A|B|C|D|E|F|a|b|c|d|e|f)))|;|/|\?|:|&|=)+@(((((([a-z]|[A-Z])|[0-9])|(([a-z]|[A-Z])|[0-9])((([a-z]|[A-Z])|[0-9])|-)*(([a-z]|[A-Z])|[0-9]))\.)*(([a-z]|[A-Z])|([a-z]|[A-Z])((([a-z]|[A-Z])|[0-9])|-)*(([a-z]|[A-Z])|[0-9])))|([0-9]+)\.([0-9]+)\.([0-9]+)\.([0-9]+)))))

            string group = String.Format(@"({0}({0}|{1}|-|\.|\+|_)*)", alpha, digit);
            string article = String.Format(@"(({0}|;|/|\?|:|&|=)+@{1})", uchar, host);
            string grouppart = String.Format(@"(\*|{0}|{1})", group, article);
            string newsurl = String.Format(@"(news:{0})", grouppart);

            #endregion


#region Nntpurl

			nntpurl:
			nntp://((((((([a-z]|[A-Z])|[0-9])|(([a-z]|[A-Z])|[0-9])((([a-z]|[A-Z])|[0-9])|-)*(([a-z]|[A-Z])|[0-9]))\.)*(([a-z]|[A-Z])|([a-z]|[A-Z])((([a-z]|[A-Z])|[0-9])|-)*(([a-z]|[A-Z])|[0-9])))|([0-9]+)\.([0-9]+)\.([0-9]+)\.([0-9]+))(:([0-9]+)){0,1})/(([a-z]|[A-Z])(([a-z]|[A-Z])|[0-9]|-|\.|\+|_)*)(/([0-9]+)){0,1}


            string nntpurl = String.Format(@"nntp://{0}/{1}(/{2}){{0,1}}", hostport, group, digits);

            #endregion


#region Telnet

			TelnetURL:
			telnet://((((((([a-z]|[A-Z])|[0-9]|(\$|-|_|\.|\+)|(!|\*|'|\(|\)|,))|(%([0-9]|A|B|C|D|E|F|a|b|c|d|e|f)([0-9]|A|B|C|D|E|F|a|b|c|d|e|f)))|;|\?|&|=)*)(:((((([a-z]|[A-Z])|[0-9]|(\$|-|_|\.|\+)|(!|\*|'|\(|\)|,))|(%([0-9]|A|B|C|D|E|F|a|b|c|d|e|f)([0-9]|A|B|C|D|E|F|a|b|c|d|e|f)))|;|\?|&|=)*)){0,1}@){0,1}((((((([a-z]|[A-Z])|[0-9])|(([a-z]|[A-Z])|[0-9])((([a-z]|[A-Z])|[0-9])|-)*(([a-z]|[A-Z])|[0-9]))\.)*(([a-z]|[A-Z])|([a-z]|[A-Z])((([a-z]|[A-Z])|[0-9])|-)*(([a-z]|[A-Z])|[0-9])))|([0-9]+)\.([0-9]+)\.([0-9]+)\.([0-9]+))(:([0-9]+)){0,1}))/{0,1}

            string telneturl = String.Format(@"telnet://{0}/{{0,1}}", login);

            #endregion


#region Gopher

			GopherURL:
			gopher://((((((([a-z]|[A-Z])|[0-9])|(([a-z]|[A-Z])|[0-9])((([a-z]|[A-Z])|[0-9])|-)*(([a-z]|[A-Z])|[0-9]))\.)*(([a-z]|[A-Z])|([a-z]|[A-Z])((([a-z]|[A-Z])|[0-9])|-)*(([a-z]|[A-Z])|[0-9])))|([0-9]+)\.([0-9]+)\.([0-9]+)\.([0-9]+))(:([0-9]+)){0,1})(/(((([a-z]|[A-Z])|[0-9]|(\$|-|_|\.|\+)|(!|\*|'|\(|\)|,))|(;|/|\?|:|@|&|=)|(%([0-9]|A|B|C|D|E|F|a|b|c|d|e|f)([0-9]|A|B|C|D|E|F|a|b|c|d|e|f)))((((([a-z]|[A-Z])|[0-9]|(\$|-|_|\.|\+)|(!|\*|'|\(|\)|,))|(;|/|\?|:|@|&|=)|(%([0-9]|A|B|C|D|E|F|a|b|c|d|e|f)([0-9]|A|B|C|D|E|F|a|b|c|d|e|f)))*)(%09((((([a-z]|[A-Z])|[0-9]|(\$|-|_|\.|\+)|(!|\*|'|\(|\)|,))|(%([0-9]|A|B|C|D|E|F|a|b|c|d|e|f)([0-9]|A|B|C|D|E|F|a|b|c|d|e|f)))|;|:|@|&|=)*)(%09(((([a-z]|[A-Z])|[0-9]|(\$|-|_|\.|\+)|(!|\*|'|\(|\)|,))|(;|/|\?|:|@|&|=)|(%([0-9]|A|B|C|D|E|F|a|b|c|d|e|f)([0-9]|A|B|C|D|E|F|a|b|c|d|e|f)))*)){0,1}){0,1}){0,1}){0,1}){0,1}

            string gtype = xchar;
            string selector = String.Format(@"({0}*)", xchar);
            string gopherplus_string = String.Format(@"({0}*)", xchar);
            string gopherurl = String.Format(@"gopher://{0}(/({1}({2}(%09{3}(%09{4}){{0,1}}){{0,1}}){{0,1}}){{0,1}}){{0,1}}", hostport, gtype, selector, search, gopherplus_string);

            #endregion


#region Wais

			WaisURL:

			(wais://((((((([a-z]|[A-Z])|[0-9])|(([a-z]|[A-Z])|[0-9])((([a-z]|[A-Z])|[0-9])|-)*(([a-z]|[A-Z])|[0-9]))\.)*(([a-z]|[A-Z])|([a-z]|[A-Z])((([a-z]|[A-Z])|[0-9])|-)*(([a-z]|[A-Z])|[0-9])))|([0-9]+)\.([0-9]+)\.([0-9]+)\.([0-9]+))(:([0-9]+)){0,1})/(((([a-z]|[A-Z])|[0-9]|(\$|-|_|\.|\+)|(!|\*|'|\(|\)|,))|(%([0-9]|A|B|C|D|E|F|a|b|c|d|e|f)([0-9]|A|B|C|D|E|F|a|b|c|d|e|f)))*))|(wais://((((((([a-z]|[A-Z])|[0-9])|(([a-z]|[A-Z])|[0-9])((([a-z]|[A-Z])|[0-9])|-)*(([a-z]|[A-Z])|[0-9]))\.)*(([a-z]|[A-Z])|([a-z]|[A-Z])((([a-z]|[A-Z])|[0-9])|-)*(([a-z]|[A-Z])|[0-9])))|([0-9]+)\.([0-9]+)\.([0-9]+)\.([0-9]+))(:([0-9]+)){0,1})/(((([a-z]|[A-Z])|[0-9]|(\$|-|_|\.|\+)|(!|\*|'|\(|\)|,))|(%([0-9]|A|B|C|D|E|F|a|b|c|d|e|f)([0-9]|A|B|C|D|E|F|a|b|c|d|e|f)))*)\?((((([a-z]|[A-Z])|[0-9]|(\$|-|_|\.|\+)|(!|\*|'|\(|\)|,))|(%([0-9]|A|B|C|D|E|F|a|b|c|d|e|f)([0-9]|A|B|C|D|E|F|a|b|c|d|e|f)))|;|:|@|&|=)*))|(wais://((((((([a-z]|[A-Z])|[0-9])|(([a-z]|[A-Z])|[0-9])((([a-z]|[A-Z])|[0-9])|-)*(([a-z]|[A-Z])|[0-9]))\.)*(([a-z]|[A-Z])|([a-z]|[A-Z])((([a-z]|[A-Z])|[0-9])|-)*(([a-z]|[A-Z])|[0-9])))|([0-9]+)\.([0-9]+)\.([0-9]+)\.([0-9]+))(:([0-9]+)){0,1})/(((([a-z]|[A-Z])|[0-9]|(\$|-|_|\.|\+)|(!|\*|'|\(|\)|,))|(%([0-9]|A|B|C|D|E|F|a|b|c|d|e|f)([0-9]|A|B|C|D|E|F|a|b|c|d|e|f)))*)/(((([a-z]|[A-Z])|[0-9]|(\$|-|_|\.|\+)|(!|\*|'|\(|\)|,))|(%([0-9]|A|B|C|D|E|F|a|b|c|d|e|f)([0-9]|A|B|C|D|E|F|a|b|c|d|e|f)))*)/(((([a-z]|[A-Z])|[0-9]|(\$|-|_|\.|\+)|(!|\*|'|\(|\)|,))|(%([0-9]|A|B|C|D|E|F|a|b|c|d|e|f)([0-9]|A|B|C|D|E|F|a|b|c|d|e|f)))*))


            string database = String.Format(@"({0}*)", uchar);
            string wtype = String.Format(@"({0}*)", uchar);
            string wpath = String.Format(@"({0}*)", uchar);
            string waisdatabase = String.Format(@"(wais://{0}/{1})", hostport, database);
            string waisindex = String.Format(@"(wais://{0}/{1}\?{2})", hostport, database, search);
            string waisdoc = String.Format(@"(wais://{0}/{1}/{2}/{3})", hostport, database, wtype, wpath);
            string waisurl = String.Format(@"{0}|{1}|{2}", waisdatabase, waisindex, waisdoc);

            #endregion


#region Mailto

			MailtoURL:
			mailto:(((([a-z]|[A-Z])|[0-9]|(\$|-|_|\.|\+)|(!|\*|'|\(|\)|,))|(;|/|\?|:|@|&|=)|(%([0-9]|A|B|C|D|E|F|a|b|c|d|e|f)([0-9]|A|B|C|D|E|F|a|b|c|d|e|f)))+)

            string encoded822addr = String.Format(@"({0}+)", xchar);
            string mailtourl = String.Format(@"mailto:{0}", encoded822addr);

            #endregion


#region File
			FILEURL:
			file://((((((([a-z]|[A-Z])|[0-9])|(([a-z]|[A-Z])|[0-9])((([a-z]|[A-Z])|[0-9])|-)*(([a-z]|[A-Z])|[0-9]))\.)*(([a-z]|[A-Z])|([a-z]|[A-Z])((([a-z]|[A-Z])|[0-9])|-)*(([a-z]|[A-Z])|[0-9])))|([0-9]+)\.([0-9]+)\.([0-9]+)\.([0-9]+)){0,1}|localhost)/(((((([a-z]|[A-Z])|[0-9]|(\$|-|_|\.|\+)|(!|\*|'|\(|\)|,))|(%([0-9]|A|B|C|D|E|F|a|b|c|d|e|f)([0-9]|A|B|C|D|E|F|a|b|c|d|e|f)))|\?|:|@|&|=)*)(/((((([a-z]|[A-Z])|[0-9]|(\$|-|_|\.|\+)|(!|\*|'|\(|\)|,))|(%([0-9]|A|B|C|D|E|F|a|b|c|d|e|f)([0-9]|A|B|C|D|E|F|a|b|c|d|e|f)))|\?|:|@|&|=)*))*)


            string fileurl = String.Format(@"file://({0}{{0,1}}|localhost)/{1}", host, fpath);

            #endregion


#region Prosperourl

			ProsperuURL
			prospero://((((((([a-z]|[A-Z])|[0-9])|(([a-z]|[A-Z])|[0-9])((([a-z]|[A-Z])|[0-9])|-)*(([a-z]|[A-Z])|[0-9]))\.)*(([a-z]|[A-Z])|([a-z]|[A-Z])((([a-z]|[A-Z])|[0-9])|-)*(([a-z]|[A-Z])|[0-9])))|([0-9]+)\.([0-9]+)\.([0-9]+)\.([0-9]+))(:([0-9]+)){0,1})/(((((([a-z]|[A-Z])|[0-9]|(\$|-|_|\.|\+)|(!|\*|'|\(|\)|,))|(%([0-9]|A|B|C|D|E|F|a|b|c|d|e|f)([0-9]|A|B|C|D|E|F|a|b|c|d|e|f)))|\?|:|@|&|=)*)(/((((([a-z]|[A-Z])|[0-9]|(\$|-|_|\.|\+)|(!|\*|'|\(|\)|,))|(%([0-9]|A|B|C|D|E|F|a|b|c|d|e|f)([0-9]|A|B|C|D|E|F|a|b|c|d|e|f)))|\?|:|@|&|=)*))*)((;(((([a-z]|[A-Z])|[0-9]|(\$|-|_|\.|\+)|(!|\*|'|\(|\)|,))|(%([0-9]|A|B|C|D|E|F|a|b|c|d|e|f)([0-9]|A|B|C|D|E|F|a|b|c|d|e|f)))|\?|:|@|&)=(((([a-z]|[A-Z])|[0-9]|(\$|-|_|\.|\+)|(!|\*|'|\(|\)|,))|(%([0-9]|A|B|C|D|E|F|a|b|c|d|e|f)([0-9]|A|B|C|D|E|F|a|b|c|d|e|f)))|\?|:|@|&)))*


            string fieldname = String.Format(@"({0}|\?|:|@|&)", uchar);
            string fieldvalue = String.Format(@"({0}|\?|:|@|&)", uchar);
            string fieldspec = String.Format(@"(;{0}={1})", fieldname, fieldvalue);
            string psegment = String.Format(@"(({0}|\?|:|@|&|=)*)", uchar);
            string ppath = String.Format(@"({0}(/{0})*)", psegment);
            string prosperourl = String.Format(@"prospero://{0}/{1}({2})*", hostport, ppath, fieldspec);

            #endregion


#region Otherurl
			OtherURL:

			(([a-z]|[0-9]|\+|-|\.)+):((((([a-z]|[A-Z])|[0-9]|(\$|-|_|\.|\+)|(!|\*|'|\(|\)|,))|(;|/|\?|:|@|&|=)|(%([0-9]|A|B|C|D|E|F|a|b|c|d|e|f)([0-9]|A|B|C|D|E|F|a|b|c|d|e|f))))*|(//((((((([a-z]|[A-Z])|[0-9]|(\$|-|_|\.|\+)|(!|\*|'|\(|\)|,))|(%([0-9]|A|B|C|D|E|F|a|b|c|d|e|f)([0-9]|A|B|C|D|E|F|a|b|c|d|e|f)))|;|\?|&|=)*)(:((((([a-z]|[A-Z])|[0-9]|(\$|-|_|\.|\+)|(!|\*|'|\(|\)|,))|(%([0-9]|A|B|C|D|E|F|a|b|c|d|e|f)([0-9]|A|B|C|D|E|F|a|b|c|d|e|f)))|;|\?|&|=)*)){0,1}@){0,1}((((((([a-z]|[A-Z])|[0-9])|(([a-z]|[A-Z])|[0-9])((([a-z]|[A-Z])|[0-9])|-)*(([a-z]|[A-Z])|[0-9]))\.)*(([a-z]|[A-Z])|([a-z]|[A-Z])((([a-z]|[A-Z])|[0-9])|-)*(([a-z]|[A-Z])|[0-9])))|([0-9]+)\.([0-9]+)\.([0-9]+)\.([0-9]+))(:([0-9]+)){0,1}))(/((((([a-z]|[A-Z])|[0-9]|(\$|-|_|\.|\+)|(!|\*|'|\(|\)|,))|(;|/|\?|:|@|&|=)|(%([0-9]|A|B|C|D|E|F|a|b|c|d|e|f)([0-9]|A|B|C|D|E|F|a|b|c|d|e|f))))*)){0,1}))


            //otherurl equal genericurl
            string urlpath = String.Format(@"(({0})*)", xchar);
            string scheme = String.Format(@"(({0}|{1}|\+|-|\.)+)", lowalpha, digit);
            string ip_schemepar = String.Format(@"(//{0}(/{1}){{0,1}})", login, urlpath);
            string schemepart = String.Format(@"(({0})*|{1})", xchar, ip_schemepar);
            string genericurl = String.Format(@"{0}:{1}", scheme, schemepart);
            string otherurl = genericurl;

            #endregion


Regex regex = new Regex(httpurl);
bool isMatchHttp = regex.IsMatch(url);

 */


char* httpUrls="http://(((((([a-zA-Z0-9])|([a-zA-Z0-9])(([a-zA-Z0-9])|-)*([a-zA-Z0-9]))\\.)*([a-zA-Z]|[a-zA-Z](([a-zA-Z0-9])|-)*([a-zA-Z0-9])))|([0-9]+)\\.([0-9]+)\\.([0-9]+)\\.([0-9]+))(:([0-9]+)){0,1})(/(((([a-zA-Z0-9]|(\\$|-|_|\\.|\\+)|(!|\\*|'|\\(|\\)|,))|(%([0-9a-fA-F])([0-9a-fA-F])))|;|:|@|&|=)*)(/(((([a-zA-Z0-9]|(\\$|-|_|\\.|\\+)|(!|\\*|'|\\(|\\)|,))|(%([0-9a-fA-F])([0-9a-fA-F])))|;|:|@|&|=)*))*(\\?(((([a-zA-Z0-9]|(\\$|-|_|\\.|\\+)|(!|\\*|'|\\(|\\)|,))|(%([0-9a-fA-F])([0-9a-fA-F])))|;|:|@|&|=)*)){0,1}){0,1}";

char * ftpurl="ftp://(((((([0-9a-zA-Z]|(\\$|-|_|\\.|\\+)|(!|\\*|'|\\(|\\)|,))|(%([0-9a-fA-F])([0-9a-fA-F])))|;|\\?|&|=)*)(:(((([0-9a-zA-Z]|(\\$|-|_|\\.|\\+)|(!|\\*|'|\\(|\\)|,))|(%([0-9a-fA-F])([0-9a-fA-F])))|;|\\?|&|=)*)){0,1}@){0,1}(((((([0-9a-zA-Z])|([0-9a-zA-Z])(([0-9a-zA-Z])|-)*([0-9a-zA-Z]))\\.)*(([a-z]|[A-Z])|([a-z]|[A-Z])(([0-9a-zA-Z])|-)*([0-9a-zA-Z])))|([0-9]+)\\.([0-9]+)\\.([0-9]+)\\.([0-9]+))(:([0-9]+)){0,1}))(/((((([0-9a-zA-Z]|(\\$|-|_|\\.|\\+)|(!|\\*|'|\\(|\\)|,))|(%([0-9a-fA-F])([0-9a-fA-F])))|\\?|:|@|&|=)*)(/(((([0-9a-zA-Z]|(\\$|-|_|\\.|\\+)|(!|\\*|'|\\(|\\)|,))|(%([0-9a-fA-F])([0-9a-fA-F])))|\\?|:|@|&|=)*))*)(;type=(A|I|D|a|i|d)){0,1}){0,1}";

char * newsurl="(news:(\\*|(([a-z]|[A-Z])([0-9a-zA-Z]|-|\\.|\\+|_)*)|(((([0-9a-zA-Z]|(\\$|-|_|\\.|\\+)|(!|\\*|'|\\(|\\)|,))|(%([0-9a-fA-F])([0-9a-fA-F])))|;|/|\\?|:|&|=)+@((((([0-9a-zA-Z])|([0-9a-zA-Z])(([0-9a-zA-Z])|-)*([0-9a-zA-Z]))\\.)*(([a-z]|[A-Z])|([a-z]|[A-Z])(([0-9a-zA-Z])|-)*([0-9a-zA-Z])))|([0-9]+)\\.([0-9]+)\\.([0-9]+)\\.([0-9]+)))))";

char * nntpurl="nntp://(((((([0-9a-zA-Z])|([0-9a-zA-Z])(([0-9a-zA-Z])|-)*([0-9a-zA-Z]))\\.)*(([a-z]|[A-Z])|([a-z]|[A-Z])(([0-9a-zA-Z])|-)*([0-9a-zA-Z])))|([0-9]+)\\.([0-9]+)\\.([0-9]+)\\.([0-9]+))(:([0-9]+)){0,1})/(([a-z]|[A-Z])([0-9a-zA-Z]|-|\\.|\\+|_)*)(/([0-9]+)){0,1}";

char * TelnetURL="telnet://(((((([0-9a-zA-Z]|(\\$|-|_|\\.|\\+)|(!|\\*|'|\\(|\\)|,))|(%([0-9a-fA-F])([0-9a-fA-F])))|;|\\?|&|=)*)(:(((([0-9a-zA-Z]|(\\$|-|_|\\.|\\+)|(!|\\*|'|\\(|\\)|,))|(%([0-9a-fA-F])([0-9a-fA-F])))|;|\\?|&|=)*)){0,1}@){0,1}(((((([0-9a-zA-Z])|([0-9a-zA-Z])(([0-9a-zA-Z])|-)*([0-9a-zA-Z]))\\.)*(([a-z]|[A-Z])|([a-z]|[A-Z])(([0-9a-zA-Z])|-)*([0-9a-zA-Z])))|([0-9]+)\\.([0-9]+)\\.([0-9]+)\\.([0-9]+))(:([0-9]+)){0,1}))/{0,1}";

char * GopherURL="gopher://(((((([0-9a-zA-Z])|([0-9a-zA-Z])(([0-9a-zA-Z])|-)*([0-9a-zA-Z]))\\.)*(([a-z]|[A-Z])|([a-z]|[A-Z])(([0-9a-zA-Z])|-)*([0-9a-zA-Z])))|([0-9]+)\\.([0-9]+)\\.([0-9]+)\\.([0-9]+))(:([0-9]+)){0,1})(/((([0-9a-zA-Z]|(\\$|-|_|\\.|\\+)|(!|\\*|'|\\(|\\)|,))|(;|/|\\?|:|@|&|=)|(%([0-9a-fA-F])([0-9a-fA-F])))(((([0-9a-zA-Z]|(\\$|-|_|\\.|\\+)|(!|\\*|'|\\(|\\)|,))|(;|/|\\?|:|@|&|=)|(%([0-9a-fA-F])([0-9a-fA-F])))*)(%09(((([0-9a-zA-Z]|(\\$|-|_|\\.|\\+)|(!|\\*|'|\\(|\\)|,))|(%([0-9a-fA-F])([0-9a-fA-F])))|;|:|@|&|=)*)(%09((([0-9a-zA-Z]|(\\$|-|_|\\.|\\+)|(!|\\*|'|\\(|\\)|,))|(;|/|\\?|:|@|&|=)|(%([0-9a-fA-F])([0-9a-fA-F])))*)){0,1}){0,1}){0,1}){0,1}){0,1}";

char * WaisURL="(wais://(((((([0-9a-zA-Z])|([0-9a-zA-Z])(([0-9a-zA-Z])|-)*([0-9a-zA-Z]))\\.)*(([a-z]|[A-Z])|([a-z]|[A-Z])(([0-9a-zA-Z])|-)*([0-9a-zA-Z])))|([0-9]+)\\.([0-9]+)\\.([0-9]+)\\.([0-9]+))(:([0-9]+)){0,1})/((([0-9a-zA-Z]|(\\$|-|_|\\.|\\+)|(!|\\*|'|\\(|\\)|,))|(%([0-9a-fA-F])([0-9a-fA-F])))*))|(wais://(((((([0-9a-zA-Z])|([0-9a-zA-Z])(([0-9a-zA-Z])|-)*([0-9a-zA-Z]))\\.)*(([a-z]|[A-Z])|([a-z]|[A-Z])(([0-9a-zA-Z])|-)*([0-9a-zA-Z])))|([0-9]+)\\.([0-9]+)\\.([0-9]+)\\.([0-9]+))(:([0-9]+)){0,1})/((([0-9a-zA-Z]|(\\$|-|_|\\.|\\+)|(!|\\*|'|\\(|\\)|,))|(%([0-9a-fA-F])([0-9a-fA-F])))*)\\?(((([0-9a-zA-Z]|(\\$|-|_|\\.|\\+)|(!|\\*|'|\\(|\\)|,))|(%([0-9a-fA-F])([0-9a-fA-F])))|;|:|@|&|=)*))|(wais://(((((([0-9a-zA-Z])|([0-9a-zA-Z])(([0-9a-zA-Z])|-)*([0-9a-zA-Z]))\\.)*(([a-z]|[A-Z])|([a-z]|[A-Z])(([0-9a-zA-Z])|-)*([0-9a-zA-Z])))|([0-9]+)\\.([0-9]+)\\.([0-9]+)\\.([0-9]+))(:([0-9]+)){0,1})/((([0-9a-zA-Z]|(\\$|-|_|\\.|\\+)|(!|\\*|'|\\(|\\)|,))|(%([0-9a-fA-F])([0-9a-fA-F])))*)/((([0-9a-zA-Z]|(\\$|-|_|\\.|\\+)|(!|\\*|'|\\(|\\)|,))|(%([0-9a-fA-F])([0-9a-fA-F])))*)/((([0-9a-zA-Z]|(\\$|-|_|\\.|\\+)|(!|\\*|'|\\(|\\)|,))|(%([0-9a-fA-F])([0-9a-fA-F])))*))";

char * MailtoURL="mailto:((([0-9a-zA-Z]|(\\$|-|_|\\.|\\+)|(!|\\*|'|\\(|\\)|,))|(;|/|\\?|:|@|&|=)|(%([0-9a-fA-F])([0-9a-fA-F])))+)";

char * FILEURL="file://(((((([0-9a-zA-Z])|([0-9a-zA-Z])(([0-9a-zA-Z])|-)*([0-9a-zA-Z]))\\.)*(([a-z]|[A-Z])|([a-z]|[A-Z])(([0-9a-zA-Z])|-)*([0-9a-zA-Z])))|([0-9]+)\\.([0-9]+)\\.([0-9]+)\\.([0-9]+)){0,1}|localhost)/((((([0-9a-zA-Z]|(\\$|-|_|\\.|\\+)|(!|\\*|'|\\(|\\)|,))|(%([0-9a-fA-F])([0-9a-fA-F])))|\\?|:|@|&|=)*)(/(((([0-9a-zA-Z]|(\\$|-|_|\\.|\\+)|(!|\\*|'|\\(|\\)|,))|(%([0-9a-fA-F])([0-9a-fA-F])))|\\?|:|@|&|=)*))*)";

char * ProsperuURL="prospero://(((((([0-9a-zA-Z])|([0-9a-zA-Z])(([0-9a-zA-Z])|-)*([0-9a-zA-Z]))\\.)*(([a-z]|[A-Z])|([a-z]|[A-Z])(([0-9a-zA-Z])|-)*([0-9a-zA-Z])))|([0-9]+)\\.([0-9]+)\\.([0-9]+)\\.([0-9]+))(:([0-9]+)){0,1})/((((([0-9a-zA-Z]|(\\$|-|_|\\.|\\+)|(!|\\*|'|\\(|\\)|,))|(%([0-9a-fA-F])([0-9a-fA-F])))|\\?|:|@|&|=)*)(/(((([0-9a-zA-Z]|(\\$|-|_|\\.|\\+)|(!|\\*|'|\\(|\\)|,))|(%([0-9a-fA-F])([0-9a-fA-F])))|\\?|:|@|&|=)*))*)((;((([0-9a-zA-Z]|(\\$|-|_|\\.|\\+)|(!|\\*|'|\\(|\\)|,))|(%([0-9a-fA-F])([0-9a-fA-F])))|\\?|:|@|&)=((([0-9a-zA-Z]|(\\$|-|_|\\.|\\+)|(!|\\*|'|\\(|\\)|,))|(%([0-9a-fA-F])([0-9a-fA-F])))|\\?|:|@|&)))*";

char * OtherURL="(([a-z]|[0-9]|\\+|-|\\.)+):(((([0-9a-zA-Z]|(\\$|-|_|\\.|\\+)|(!|\\*|'|\\(|\\)|,))|(;|/|\\?|:|@|&|=)|(%([0-9a-fA-F])([0-9a-fA-F]))))*|(//(((((([0-9a-zA-Z]|(\\$|-|_|\\.|\\+)|(!|\\*|'|\\(|\\)|,))|(%([0-9a-fA-F])([0-9a-fA-F])))|;|\\?|&|=)*)(:(((([0-9a-zA-Z]|(\\$|-|_|\\.|\\+)|(!|\\*|'|\\(|\\)|,))|(%([0-9a-fA-F])([0-9a-fA-F])))|;|\\?|&|=)*)){0,1}@){0,1}(((((([0-9a-zA-Z])|([0-9a-zA-Z])(([0-9a-zA-Z])|-)*([0-9a-zA-Z]))\\.)*(([a-z]|[A-Z])|([a-z]|[A-Z])(([0-9a-zA-Z])|-)*([0-9a-zA-Z])))|([0-9]+)\\.([0-9]+)\\.([0-9]+)\\.([0-9]+))(:([0-9]+)){0,1}))(/(((([0-9a-zA-Z]|(\\$|-|_|\\.|\\+)|(!|\\*|'|\\(|\\)|,))|(;|/|\\?|:|@|&|=)|(%([0-9a-fA-F])([0-9a-fA-F]))))*)){0,1}))";



int UrlMatch(void)
{
    /*匹配的目标串*/
	char src[]="foo.bar hello 欢迎访问我的地址：www.baidu.com and another url like http://www.uestc.edu.cn besides www.tsinghua.edu.cn is also available, www.stanford.edu";
    /*规则*/
    char * regWeb2="(^|\\b)(((https|http|ftp|rtsp|mms)?\\:\\/\\/)[^\\s]+)($|\\b)";
	/*char* regWeb="(^|\\b)(((([hH][tT]{2}[pP][sS]?)|([fF][tT][pP]))\\:\\/\\/){0,1}([wW]{3}\\.){0,1}[\\w-]+(\\.\\w{2,4})+(\\/.*)?)($|\\b)";*/
    return compliemain(regWeb2,flags?txtstr:src);
}
